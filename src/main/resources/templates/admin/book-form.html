<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aziz BookShop - Book Form</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
<div class="container">
    <h1 th:text="${book.id != null} ? 'Edit Book' : 'Add New Book'"></h1>

    <div th:if="${error}" class="error" th:text="${error}"></div>

    <form th:action="@{/admin/book/save}" th:object="${book}" method="post" onsubmit="return validateBookForm()">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <input type="hidden" th:field="*{id}">

        <div class="form-group">
            <label for="title">Title:</label>
            <input type="text" id="title" th:field="*{title}"
                   required
                   maxlength="255"
                   pattern="[A-Za-z0-9\s\-',.:!?&()]{1,255}">
            <small>Letters, numbers, and common punctuation only</small>
        </div>

        <div class="form-group">
            <label for="author">Author:</label>
            <input type="text" id="author" th:field="*{author}"
                   required
                   maxlength="255"
                   pattern="[A-Za-z\s\-',.]{1,255}">
            <small>Letters, spaces, hyphens, and apostrophes only</small>
        </div>

        <div class="form-group">
            <label for="year">Year:</label>
            <input type="number" id="year" th:field="*{year}"
                   min="1000" max="2100"
                   required>
        </div>

        <div class="form-group">
            <label for="price">Price:</label>
            <input type="number" id="price" th:field="*{price}"
                   step="0.01" min="0" max="9999.99"
                   required>
            <small>Price in USD (0.00 - 9999.99)</small>
        </div>

        <div class="form-group">
            <label for="copies">Number of Copies:</label>
            <input type="number" id="copies" th:field="*{copies}"
                   min="0" max="10000"
                   required>
        </div>

        <button type="submit">Save Book</button>
        <a th:href="@{/admin/dashboard}">Cancel</a>
    </form>
</div>

<script>
    function validateBookForm() {
        const title = document.getElementById('title').value;
        const author = document.getElementById('author').value;
        const price = parseFloat(document.getElementById('price').value);
        const copies = parseInt(document.getElementById('copies').value);

        if (title.trim().length === 0) {
            alert('Title cannot be empty');
            return false;
        }

        if (author.trim().length === 0) {
            alert('Author cannot be empty');
            return false;
        }

        if (price < 0 || price > 9999.99) {
            alert('Price must be between $0 and $9999.99');
            return false;
        }

        if (copies < 0 || copies > 10000) {
            alert('Number of copies must be between 0 and 10000');
            return false;
        }

        return true;
    }
</script>
</body>
</html>